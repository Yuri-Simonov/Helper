<mat-accordion>
    <mat-expansion-panel
        (opened)="panelOpenState = true"
        (closed)="panelOpenState = false"
    >
        <mat-expansion-panel-header>
            <mat-panel-title>
                Зачем в Angular сервис "ChangeDetectorRef"?
            </mat-panel-title>
        </mat-expansion-panel-header>
        <p>
            Сервис <code>ChangeDetectorRef</code> позволяет взять управление
            механизмом отслеживания изменений (<code>ChangeDetection</code>)
            полностью под свой контроль.
        </p>
        <p>Методы сервиса:</p>
        <ul>
            <li>
                <span class="attention">detach</span> - полностью отключает
                механизм <code>ChangeDetection</code>. Здесь также важно
                уточнить, что если мы отключаем у родителя проверку изменений,
                то и у его дочерних компонентов она будет отключена,
                соответственно, и DOM-дерево тоже не будет обновляться;
            </li>
            <li>
                <span class="attention">reattach</span> - используется после
                вызова <code>detach</code> для активации механизма
                <code>ChangeDetection</code>. Стоит добавить, что данный метод
                полезен только для компонентов верхнего уровня, где отключен
                механизм <code>ChangeDetection</code>, т.к. если у родителя он
                выключен, то на дочерние компоненты метод
                <code>reattach</code> не произведет никакого эффекта;
            </li>
            <li>
                <span class="attention">markForCheck</span> - помечает как
                "измененный" текущий компонент, где данный метод был вызван, а
                также все родительские компоненты, вплоть до корневого
                компонента. И при следующем запуске механизма
                <code>ChangeDetection</code> он пройдет по "помеченной" ветке и
                отрисует изменения, если они есть. Сработает только 1 раз;
            </li>
            <li>
                <span class="attention">detectChanges</span> - одноразово
                запускает механизм отслеживания изменений для текущего
                компонента и его потомков;
            </li>
            <li>
                <span class="attention">checkNoChanges</span> - данный метод
                гарантирует отсутствие изменений на текущем запуске
                <code>ChangeDetection</code>, выбрасывая исключение, если
                входящие свойства были изменены, либо есть необходимость
                обновить DOM.
            </li>
        </ul>
        <p>
            В примере ниже изначально отключается механизм отслеживания
            изменений в конструкторе. Затем в переменную
            <code>value</code> вносятся изменения, но они не отобразятся сразу
            на странице. Чтобы их отобразить, мы должны нажать на кнопку,
            которая представлена в шаблоне, т.к. к ней привязана функция,
            отвечающая за принудительный запуск механизма отслеживания.
        </p>
        <pre><code><span class="comment">// шаблон</span>
<span class="tag"><</span><span class="tag">button</span> <span class="keyword">(click)</span><span class="operator">=</span><span class="punctuation">"</span><span class="function-name">applyChanges()</span><span class="punctuation">"</span><span class="tag">></span>Применить изменения<span class="tag"><</span><span class="tag">button/></span>
<span></span>
<span class="comment">// компонент</span>
<span class="export">export</span> <span class="keyword">class</span> <span class="class-name">ManualDetectionComponent</span> <span class="punctuation">{{'{'}}</span>
	value: <span class="type">string</span> <span class="operator">=</span> <span class="string">'Начальное значение'</span>; 
	<span></span>
	<span class="keyword">constructor</span><span class="punctuation">(</span><span class="keyword">private</span> <span>changeDetectorRef</span>: <span class="class-name">ChangeDetectorRef</span><span class="punctuation">) {{'{'}}</span>
		<span class="object">this</span>.changeDetection.<span class="method">detach</span><span class="punctuation">()</span>; <span class="comment">// отключаем механизм ChangeDetection</span>
		<span class="object">this</span>.value <span class="operator">=</span> <span class="string">'Какие-то изменения'</span>;
	<span class="punctuation">{{'}'}}</span>
	<span></span>
	<span class="function-name">applyChanges</span><span class="punctuation">():</span> <span class="type">void</span> <span class="punctuation">{{'{'}}</span>
		<span class="object">this</span>.changeDetection.<span class="method">detectChanges</span><span class="punctuation">()</span>; <span class="comment">// принудительно запускаем механизм ChangeDetection</span>
	<span class="punctuation">{{'}'}}</span>
<span class="punctuation">{{'}'}}</span></code></pre>
    </mat-expansion-panel>
</mat-accordion>
