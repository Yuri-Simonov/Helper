<mat-accordion>
    <mat-expansion-panel
        (opened)="panelOpenState = true"
        (closed)="panelOpenState = false"
    >
        <mat-expansion-panel-header>
            <mat-panel-title>
                Зачем в Angular сервис "ChangeDetectionRef"?
            </mat-panel-title>
        </mat-expansion-panel-header>
        <p>
            Сервис <code>ChangeDetectorRef</code> позволяет взять управление
            механизмом отслеживания изменений (<code>ChangeDetector</code>)
            полностью под свой контроль.
        </p>
        <p>Основные методы сервиса:</p>
        <ul>
            <li>
                <span class="attention">detach</span> - полностью отключает
                механизм <code>ChangeDetector</code>;
            </li>
            <li>
                <span class="attention">detectChanges</span> - принудительно
                запускает механизм отслеживания изменений;
            </li>
            <li>
                <span class="attention">reattach</span> - используется после
                вызова <code>detach</code> для активации механизма
                <code>ChangeDetection</code>.
            </li>
        </ul>
        <p>
            Действие всех трех методов
            <span class="attention"
                >распространяется только на тот компонент, в пределах которого
                вызываются эти методы.</span
            >
        </p>
        <pre><code><span class="comment">// шаблон</span>
<span class="tag"><</span><span class="tag">button</span> <span class="keyword">(click)</span><span class="operator">=</span><span class="punctuation">"</span><span class="function-name">applyChanges()</span><span class="punctuation">"</span><span class="tag">></span>Применить изменения<span class="tag"><</span><span class="tag">button/></span>
<span></span>
<span class="comment">// компонент</span>
<span class="export">export</span> <span class="keyword">class</span> <span class="class-name">ManualDetectionComponent</span> <span class="punctuation">{{'{'}}</span>
	value: <span class="type">string</span> <span class="operator">=</span> <span class="string">'Начальное значение'</span>; 
	<span></span>
	<span class="keyword">constructor</span><span class="punctuation">(</span><span class="keyword">private</span> <span>changeDetection</span>: <span class="class-name">ChangeDetectorRef</span><span class="punctuation">{{') {'}}</span>
		<span class="object">this</span>.changeDetection.<span class="method">detach</span><span class="punctuation">()</span>; <span class="comment">// отключаем механизм ChangeDetection</span>
		<span class="object">this</span>.value <span class="operator">=</span> <span class="string">'Какие-то изменения'</span>;
	<span class="punctuation">{{'}'}}</span>
	<span></span>
	<span class="function-name">applyChanges</span><span class="punctuation">():</span> <span class="type">void</span> <span class="punctuation">{{'{'}}</span>
		<span class="object">this</span>.changeDetection.<span class="method">detectChanges</span><span class="punctuation">()</span>; <span class="comment">// принудительно запускаем механизм ChangeDetection</span>
	<span class="punctuation">{{'}'}}</span>
<span class="punctuation">{{'}'}}</span></code></pre>
        <p>
            В примере выше изначально отключается механизм отслеживания
            изменений в конструкторе. Затем в переменную
            <code>value</code> вносятся изменения, но они не отобразятся сразу
            на странице. Чтобы их отобразить, мы должны нажать на кнопку,
            которая представлена в шаблоне, т.к. к ней привязана функция,
            отвечающая за принудительный запуск механизма отслеживания.
        </p>
    </mat-expansion-panel>
</mat-accordion>
